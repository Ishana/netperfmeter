
#!/bin/bash
# $Id: run-wp3-dsl-ccI 1140 2011-11-23 06:43:27Z dreibh $
#
# Network Performance Meter
# Copyright (C) 2009-2012 by Thomas Dreibholz
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
#MPTCP-West
#route change -net 113.59.104.56/29 132.252.153.9
#route change -net 210.37.45.128/29 89.246.242.226
#haikou-cmt
#route change -net 132.252.153.8/29 210.37.45.190
#route change -net 89.246.242.224/29 113.59.104.62
#MPTCP-east
#route change -net 113.59.104.56/29 132.252.153.17
#route change -net 210.37.45.128/29 89.246.242.226
#haikou-mptcp
#route change -net 132.252.153.8/29 210.37.45.190
#route change -net 89.246.242.224/29 113.59.104.62
#route change default 113.59.104.62
#ssh demo@113.59.104.59 'route add -net 89.246.242.224/29 113.59.104.62 &' &
#ssh demo@113.59.104.59 'route add -net 132.252.153.8/29 113.59.104.62'
 







rm runlog.txt


time="300" 
waittime=


runnumber=1000
n=61
run_value="26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60"





echo "ssh demo@113.59.104.59 'route add -net 132.252.153.8/29 113.59.104.62'"
ssh demo@113.59.104.59 'route add -net 132.252.153.8/29 113.59.104.62'

echo "route add -net 113.59.104.56/29 132.252.153.9"
route add -net 113.59.104.56/29 132.252.153.9

echo "route add -net 210.37.45.128/29 89.246.242.226"
route add -net 210.37.45.128/29 89.246.242.226

echo "ssh demo@113.59.104.59 'route add -net 89.246.242.224/29 210.37.45.190' "
ssh demo@113.59.104.59 'route add -net 89.246.242.224/29 210.37.45.190' 



echo "waiting $waittime s "
sleep $waittime



while [ $n -le $runnumber ];
do
       run_value="$run_value $n"
       n=$(($n+1))
	
	echo "starting runs $run_value "
	echo
	echo

	
	echo "starting runs $run_value "
	echo
	echo

	date
	date >>runlog.txt
	echo "runvalue = $run_value " >>runlog.txt












	echo "start primary DFN-Unicom"
	echo
	echo
	date

	#DFN-Unicom
	echo "route change default 132.252.153.9"
	route change default 132.252.153.9

	echo "ssh demo@113.59.104.59 'route change -net 132.252.153.8/29 113.59.104.62'"
	ssh demo@113.59.104.59 'route change -net 132.252.153.8/29 113.59.104.62'

	echo "route change -net 113.59.104.56/29 132.252.153.9"
	route change -net 113.59.104.56/29 132.252.153.9

	echo "route change -net 210.37.45.128/29 89.246.242.226"
	route change -net 113.59.104.56/29 132.252.153.9

	echo "ssh demo@113.59.104.59 'route change -net 89.246.242.224/29 210.37.45.190' "
	ssh demo@113.59.104.59 'route change -net 89.246.242.224/29 210.37.45.190' 

	echo "waiting $waittime s "
	sleep $waittime

	echo "route change default 132.252.153.9"
	route change default 132.252.153.9



	echo "waiting $waittime s "
	sleep $waittime

	echo "	./run-essen-haikou-SP "DFN-Unicom-SP" "$run_value" "haikou-cmt-DFN-unicom-mpctp-west-SP" "$time" "
	./run-essen-haikou-SP "DFN-Unicom-SP" "$run_value" "haikou-cmt-DFN-unicom-mpctp-west-SP" "$time" 

	date >>runlog.txt
	echo "DFN-Unicom-SP ==> OK " >>runlog.txt


	echo "	./run-essen-haikou-cmt "DFN-Unicom-CMT" "$run_value" "Essen_Haikou-cmt-DFN-unicom" "$time" "
	./run-essen-haikou-cmt "DFN-Unicom-CMT" "$run_value" "Essen_Haikou-cmt-DFN-unicom" "$time" 

	date >>runlog.txt
	echo "DFN-Unicom-CMT " >>runlog.txt



	echo "MPTCP measurements on MPTCP-east "DFN-Unicom-SP" "$run_value" "Essen_Haikou-MPTCP-DFN-unicom_from-MPTCP-East" "$time""
	echo $run_value > run_value.val
	echo $time > time.val
	echo "DFN-Unicom-mptcp" > folder.val
	echo "Essen_Haikou-MPTCP-DFN-unicom_from-MPTCP-East" > scenario.val
	scp *.val commands demo@132.252.153.19:/home/demo/src/netperfmeter/src/hakim-tests/haikou-paper/essen-haikou/mptcp/.
	ssh demo@132.252.153.19 'cd /home/demo/src/netperfmeter/src/hakim-tests/haikou-paper/essen-haikou/mptcp/ && ./start_multiple_scripts_manual'

	date >>runlog.txt
	echo "DFN-Unicom-MPTCP " >>runlog.txt



	echo "route change default 89.246.242.226"
	route change default 89.246.242.226

	./run-essen-haikou-SP "Versatel-Cernet-SP" "$run_value" "haikou-cmt-Versatel-uninet-mpctp-west-SP" "$time" 
	date >>runlog.txt
	echo "Versatel-Cernet-SP " >>runlog.txt


	./run-essen-haikou-cmt "Versatel-Cernet-CMT" "$run_value" "Essen_Haikou-cmt-Versatel-uninet" "$time" 
	date >>runlog.txt
	echo "Versatel-Cernet-CMT " >>runlog.txt


	echo "MPTCP measurements on MPTCP-east "Versatel-Cernet-mptcp" "$run_value" "Essen_Haikou-MPTCP-Versatel-uninet_from-MPTCP-East" "$time""
	echo $run_value > run_value.val
	echo $time > time.val
	echo "Versatel-Cernet-mptcp" > folder.val
	echo "Essen_Haikou-MPTCP-Versatel-uninet_from-MPTCP-East" > scenario.val
	scp *.val commands demo@132.252.153.19:/home/demo/src/netperfmeter/src/hakim-tests/haikou-paper/essen-haikou/mptcp/.
	ssh demo@132.252.153.19 'cd /home/demo/src/netperfmeter/src/hakim-tests/haikou-paper/essen-haikou/mptcp/ && ./start_multiple_scripts_manual'

	date >>runlog.txt
	echo "Versatel-Cernet-MPTCP " >>runlog.txt











	echo "start primary DFN-Cernet"
	echo
	echo



	#DFN-Cernet
	echo "route change default 132.252.153.9"
	route change default 132.252.153.9

	echo "ssh demo@113.59.104.59 'route change -net 89.246.242.224/29 113.59.104.62' "
	ssh demo@113.59.104.59 'route change -net 89.246.242.224/29 113.59.104.62' 

	echo "route change -net 210.37.45.128/29 132.252.153.9"
	route change -net 210.37.45.128/29 132.252.153.9

	echo "route change -net 113.59.104.56/29 89.246.242.226"
	route change -net 113.59.104.56/29 89.246.242.226

	echo "ssh demo@113.59.104.59 'route change -net 132.252.153.8/29 210.37.45.190'"
	ssh demo@113.59.104.59 'route change -net 132.252.153.8/29 210.37.45.190'



	echo "	./run-essen-haikou-SP "DFN-Cernet-SP" "$run_value" "haikou-cmt-DFN-uninet-mpctp-west-SP" "$time" "
	./run-essen-haikou-SP "DFN-Cernet-SP" "$run_value" "haikou-cmt-DFN-uninet-mpctp-west-SP" "$time" 

	date >>runlog.txt
	echo "DFN-Cernet-SP " >>runlog.txt



	echo "	./run-essen-haikou-cmt "DFN-Cernet-CMT" "$run_value" "Essen_Haikou-cmt-DFN-uninet" "$time" "
	./run-essen-haikou-cmt "DFN-Cernet-CMT" "$run_value" "Essen_Haikou-cmt-DFN-uninet" "$time" 

	date >>runlog.txt
	echo "DFN-Cernet-CMT " >>runlog.txt


	echo "MPTCP measurements on MPTCP-east "DFN-Cernet-mptcp" "$run_value" "Essen_Haikou-MPTCP-DFN-uninet_from-MPTCP-East" "$time""
	echo $run_value > run_value.val
	echo $time > time.val
	echo "DFN-Cernet-mptcp" > folder.val
	echo "Essen_Haikou-MPTCP-DFN-uninet_from-MPTCP-East" > scenario.val
	scp *.val commands demo@132.252.153.19:/home/demo/src/netperfmeter/src/hakim-tests/haikou-paper/essen-haikou/mptcp/.
	ssh demo@132.252.153.19 'cd /home/demo/src/netperfmeter/src/hakim-tests/haikou-paper/essen-haikou/mptcp/ && ./start_multiple_scripts_manual'

	date >>runlog.txt
	echo "DFN-Cernet-MPTCP " >>runlog.txt



	echo "route change default 89.246.242.226"
	route change default 89.246.242.226

	echo "	./run-essen-haikou-SP "Versatel-Unicom-SP" "$run_value" "haikou-cmt-Versatel-unicom-mpctp-west-SP" $time" ""
	./run-essen-haikou-SP "Versatel-Unicom-SP" "$run_value" "haikou-cmt-Versatel-unicom-mpctp-west-SP" $time" "

	date >>runlog.txt
	echo "Versatel-Unicom-SP " >>runlog.txt


	echo "./run-essen-haikou-cmt "Versatel-unicom-CMT" "$run_value" "Essen_Haikou-cmt-Versatel-unicom" "$time" "
	./run-essen-haikou-cmt "Versatel-unicom-CMT" "$run_value" "Essen_Haikou-cmt-Versatel-unicom" "$time" 
	
	date >>runlog.txt
	echo "Versatel-Unicom-cmt " >>runlog.txt

	echo "MPTCP measurements on MPTCP-east "Versatel-Unicom-mptcp" "$run_value" "Essen_Haikou-MPTCP-Versatel-unicom_from-MPTCP-East" "$time""
	echo $run_value > run_value.val
	echo $time > time.val
	echo "Versatel-Unicom-mptcp" > folder.val
	echo "Essen_Haikou-MPTCP-Versatel-unicom_from-MPTCP-East" > scenario.val
	scp *.val commands demo@132.252.153.19:/home/demo/src/netperfmeter/src/hakim-tests/haikou-paper/essen-haikou/mptcp/.
	ssh demo@132.252.153.19 'cd /home/demo/src/netperfmeter/src/hakim-tests/haikou-paper/essen-haikou/mptcp/ && ./start_multiple_scripts_manual'


	date >>runlog.txt
	echo "Versatel-Unicom-MPTCP " >>runlog.txt


	echo $run_value >runs-finisched.txt


done


echo "Finishing... deleting all routes"

echo "ssh demo@113.59.104.59 'route del -net 89.246.242.224/29 113.59.104.62' "
ssh demo@113.59.104.59 'route del -net 89.246.242.224/29 113.59.104.62' 

echo "ssh demo@113.59.104.59 'route del -net 132.252.153.8/29 210.37.45.190'"
ssh demo@113.59.104.59 'route del -net 132.252.153.8/29 210.37.45.190'

echo "route del -net 210.37.45.128/29 132.252.153.9"
route del -net 210.37.45.128/29 132.252.153.9

echo "route del -net 113.59.104.56/29 89.246.242.226"
route del -net 113.59.104.56/29 89.246.242.226




