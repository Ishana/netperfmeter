
#!/bin/bash
# $Id: run-wp3-dsl-ccI 1140 2011-11-23 06:43:27Z dreibh $
#
# Network Performance Meter
# Copyright (C) 2009-2012 by Thomas Dreibholz
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
#



RateNorthernTrail="200 500 800 1000 1250 1500  1750 2001 2250  2500 2750 3000" #4
#RateNorthernTrail="1500 3000" #4

#ssh demo@132.252.153.19 '/home/demo/src/netperfmeter/src/./start-servers-testbed & '
#ssh demo@132.252.153.19 '/home/demo/src/netperfmeter/src/./setqos-MPTCP-east'


time="300" 
waittime=20


runnumber=10
n=3
run_value="1 2"
route add -net 132.252.153.16/29 132.252.153.9
route add -net 132.252.153.144/29 132.252.153.137
ssh demo@132.252.153.19 'route add -net 132.252.153.8/29 132.252.153.17 & route add -net 132.252.153.136/29 132.252.153.145'

while [ $n -le $runnumber ];
do
       run_value="$run_value $n"
       n=$(($n+1))
	
	echo "starting runs $run_value "
	echo
	echo

	
	echo "starting runs $run_value "
	echo
	echo

	echo "start primary 8-16"
	echo
	echo
	date
	echo "Changing route on 132.252.153.12 to  132.252.153.9"
	route change default 132.252.153.9
	echo "waiting $waittime s "
	sleep $waittime

	route change -net 132.252.153.16/29 132.252.153.9
	route change -net 132.252.153.144/29 132.252.153.137


	echo "Changing route on 132.252.153.19 to  132.252.153.17"
	ssh demo@132.252.153.19 'route change default 132.252.153.17'

	ssh demo@132.252.153.19 'route change -net 132.252.153.8/29 132.252.153.17 & route change -net 132.252.153.136/29 132.252.153.145'

	echo "waiting $waittime s "
	sleep $waittime

	./run-local-multiple-bandwith-disimilar-SCTP-4paths "8-16" "$run_value" "$time" "$RateNorthernTrail" "MPCTP-West_MPCTP-east-SCTP-4paths-8-16"





	echo "start primary 136-16"
	echo
	echo
	date
	echo "Changing route on 132.252.153.12 to  132.252.153.137"
	route change -net 132.252.153.16/29 132.252.153.137
	route change -net 132.252.153.144/29 132.252.153.9
	echo "waiting $waittime s "
	sleep $waittime


	./run-local-multiple-bandwith-disimilar-SCTP-4paths "136-16" "$run_value" "$time" "$RateNorthernTrail" "MPCTP-West_MPCTP-east-SCTP-4paths-136-16"


	echo "start primary 136-144"
	echo
	echo
	echo "Changing route on 132.252.153.19 to  132.252.153.145"
	ssh demo@132.252.153.19 'route change -net 132.252.153.8/29 132.252.153.145 & route change -net 132.252.153.136/29 132.252.153.17'
	echo "waiting $waittime s "
	sleep $waittime

	./run-local-multiple-bandwith-disimilar-SCTP-4paths "136-144" "$run_value" "$time" "$RateNorthernTrail"  "MPCTP-West_MPCTP-east-SCTP-4paths-136-144"


	echo "start primary 8-144"
	echo
	echo
	date
	echo "Changing route on 132.252.153.12 to  132.252.153.9"
	route change -net 132.252.153.16/29 132.252.153.9
	route change -net 132.252.153.144/29 132.252.153.137

	echo "waiting $waittime s "
	sleep $waittime

	./run-local-multiple-bandwith-disimilar-SCTP-4paths "8-144" "$run_value" "$time" "$RateNorthernTrail"  "MPCTP-West_MPCTP-east-SCTP-4paths-8-144"






done


echo "Finishing... Changing route on 132.252.153.12 back to  132.252.153.9"
route change default 132.252.153.9
route change -net 132.252.153.16/29 132.252.153.9
route change -net 132.252.153.144/29 132.252.153.137

echo "waiting $waittime s "
sleep $waittime

echo "Changing route on 132.252.153.19 to  132.252.153.17"
ssh demo@132.252.153.19 'route change default 132.252.153.17'
ssh demo@132.252.153.19 'route change -net 132.252.153.8/29 132.252.153.17 & route change -net 132.252.153.136/29 132.252.153.145'
echo "waiting $waittime s"
waittime=20
